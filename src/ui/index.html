<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expert Sourcing Service</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 700;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .nav-button {
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }
        
        .nav-button:hover {
            background: #2563eb;
        }
        
        .nav-button.active {
            background: #667eea;
        }
        
        .job-card {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .job-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .job-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .job-status.pending {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .job-status.processing {
            background-color: #dbeafe;
            color: #1e40af;
        }
        
        .job-status.completed {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .job-status.failed {
            background-color: #fee;
            color: #991b1b;
        }
        
        .job-description {
            background-color: #f3f4f6;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .metadata {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .metadata > div {
            flex: 1;
            min-width: 200px;
        }
        
        .llm-status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            margin: 20px 0;
        }
        
        .llm-status-indicator:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .llm-status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .llm-status-dot.healthy {
            background-color: #10b981;
        }
        
        .llm-status-dot.warning {
            background-color: #f59e0b;
        }
        
        .llm-status-dot.error {
            background-color: #ef4444;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            background: #10b981;
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            z-index: 2000;
            font-weight: 500;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .notification.error {
            background: #ef4444;
        }
        
        .llm-metrics-popup {
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 10px;
            background: rgba(31, 41, 55, 0.98);
            backdrop-filter: blur(10px);
            color: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 20px;
            min-width: 400px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }
        
        .llm-status-indicator:hover .llm-metrics-popup {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .llm-metrics-popup h3 {
            color: white;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .metric-card {
            text-align: center;
            padding: 10px;
            background: #f9fafb;
            border-radius: 8px;
        }
        
        .metric-label {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 5px;
        }
        
        .metric-value {
            font-size: 20px;
            font-weight: bold;
            color: #1f2937;
        }
        
        .metrics-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        .metrics-table th,
        .metrics-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .metrics-table th {
            background-color: #f9fafb;
            font-weight: 600;
            color: #374151;
        }
        
        .expert-filters {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .filter-label {
            font-weight: 500;
            color: #374151;
        }
        
        .filter-button {
            padding: 6px 12px;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .filter-button:hover {
            background: #f3f4f6;
            border-color: #3b82f6;
        }
        
        .filter-button.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .expert-grid {
            display: grid;
            gap: 20px;
        }
        
        .expert-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .expert-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .expert-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }
        
        .expert-info h3 {
            margin-bottom: 5px;
        }
        
        .expert-info h3 a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .expert-info h3 a:hover {
            color: #764ba2;
        }
        
        .no-linkedin {
            color: #1f2937;
        }
        
        .expert-title {
            color: #4b5563;
            font-size: 0.95rem;
            margin-bottom: 3px;
        }
        
        .expert-company {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .expert-score {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 16px;
            cursor: help;
            position: relative;
        }
        
        .score-tooltip {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 10px;
            background: #1f2937;
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85rem;
            width: 250px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .expert-score:hover .score-tooltip {
            opacity: 1;
        }
        
        .score-breakdown {
            margin-top: 8px;
        }
        
        .score-item {
            display: flex;
            justify-content: space-between;
            margin: 4px 0;
            padding: 4px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .score-item:last-child {
            border-bottom: none;
        }
        
        .expert-email {
            margin-top: 5px;
            font-size: 0.9rem;
            color: #6b7280;
        }
        
        .expert-email a {
            color: #3b82f6;
            text-decoration: none;
        }
        
        .expert-email a:hover {
            text-decoration: underline;
        }
        
        .no-email {
            color: #9ca3af;
            font-style: italic;
        }
        
        .expert-reasons {
            margin-top: 15px;
        }
        
        .expert-reasons h4 {
            font-size: 14px;
            color: #4b5563;
            margin-bottom: 8px;
        }
        
        .expert-reasons ul {
            list-style: none;
            padding-left: 0;
        }
        
        .expert-reasons li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
            color: #374151;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .expert-reasons li:before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #10b981;
            font-weight: bold;
        }
        
        .expert-expertise {
            margin-top: 15px;
        }
        
        .expert-expertise h4 {
            font-size: 14px;
            color: #4b5563;
            margin-bottom: 8px;
        }
        
        .expertise-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
        
        .expertise-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .expert-topics {
            margin-top: 15px;
        }
        
        .expert-topics h4 {
            font-size: 14px;
            color: #4b5563;
            margin-bottom: 8px;
        }
        
        .expert-topics ul {
            list-style: none;
            padding-left: 0;
        }
        
        .expert-topics li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            color: #6b7280;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .expert-topics li:before {
            content: '→';
            position: absolute;
            left: 0;
            color: #3b82f6;
        }
        
        .expert-actions {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e5e7eb;
        }
        
        .source-link {
            color: #3b82f6;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .source-link:hover {
            text-decoration: underline;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        
        .error {
            background-color: #fee;
            color: #c00;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        
        .create-job-form {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
        }
        
        .form-input,
        .form-textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s ease;
        }
        
        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .effort-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 10px;
        }
        
        .effort-option {
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .effort-option:hover {
            border-color: #3b82f6;
            background: #f0f9ff;
        }
        
        .effort-option.selected {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        
        .effort-option h4 {
            margin-bottom: 5px;
            color: #1f2937;
        }
        
        .effort-option p {
            font-size: 14px;
            color: #6b7280;
            margin: 0;
        }
        
        .form-submit {
            background: #3b82f6;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .form-submit:hover {
            background: #2563eb;
        }
        
        .form-submit:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>Expert Sourcing Service</h1>
        </div>
    </div>
    
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        function App() {
            const [view, setView] = useState('jobs');
            const [jobs, setJobs] = useState([]);
            const [selectedJob, setSelectedJob] = useState(null);
            const [jobDetails, setJobDetails] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [notification, setNotification] = useState({ show: false, message: '', type: 'success' });
            
            const showNotification = (message, type = 'success') => {
                setNotification({ show: true, message, type });
                setTimeout(() => {
                    setNotification({ show: false, message: '', type: 'success' });
                }, 3000);
            };
            
            useEffect(() => {
                if (view === 'jobs') {
                    loadJobs();
                }
            }, [view]);
            
            useEffect(() => {
                if (selectedJob) {
                    loadJobDetails(selectedJob);
                }
            }, [selectedJob]);
            
            const loadJobs = async () => {
                setLoading(true);
                try {
                    const response = await fetch('/api/v1/jobs');
                    if (!response.ok) {
                        throw new Error('Failed to load jobs');
                    }
                    const data = await response.json();
                    setJobs(data.requests || []);
                } finally {
                    setLoading(false);
                }
            };
            
            const loadJobDetails = async (jobId) => {
                setLoading(true);
                try {
                    const response = await fetch(`/api/v1/source/${jobId}`);
                    if (!response.ok) {
                        throw new Error('Failed to load job details');
                    }
                    const jobData = await response.json();
                    setJobDetails(jobData);
                    setView('details');
                } finally {
                    setLoading(false);
                }
            };
            
            const formatDate = (dateString) => {
                return new Date(dateString).toLocaleString();
            };
            
            const createJob = async (projectDescription, effortLevel) => {
                setLoading(true);
                try {
                    const response = await fetch('/api/v1/source', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ project_description: projectDescription })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to create job');
                    }
                    
                    const result = await response.json();
                    showNotification(`Job created successfully! ID: ${result.request_id}`);
                    setView('jobs');
                    // Reload jobs after a short delay to ensure the new job is indexed
                    setTimeout(() => {
                        loadJobs();
                    }, 1000);
                } catch (error) {
                    setError(error.message);
                } finally {
                    setLoading(false);
                }
            };
            
            return (
                <div className="container">
                    <div className="nav-buttons">
                        <button 
                            className={`nav-button ${view === 'jobs' ? 'active' : ''}`}
                            onClick={() => setView('jobs')}
                        >
                            View Jobs
                        </button>
                        <button 
                            className={`nav-button ${view === 'create' ? 'active' : ''}`}
                            onClick={() => setView('create')}
                        >
                            Create New Job
                        </button>
                    </div>
                    
                    <div className={`notification ${notification.type} ${notification.show ? 'show' : ''}`}>
                        {notification.message}
                    </div>
                    
                    {error && <div className="error">Error: {error}</div>}
                    
                    {loading && <div className="loading">Loading...</div>}
                    
                    {!loading && view === 'jobs' && (
                        <JobList jobs={jobs} onSelectJob={setSelectedJob} />
                    )}
                    
                    {!loading && view === 'details' && jobDetails && (
                        <JobDetails job={jobDetails} showNotification={showNotification} />
                    )}
                    
                    {!loading && view === 'create' && (
                        <CreateJobForm onSubmit={createJob} />
                    )}
                </div>
            );
        }
        
        function JobList({ jobs, onSelectJob }) {
            return (
                <div className="job-list">
                    <h2 style={{ marginBottom: '20px' }}>Sourcing Jobs</h2>
                    {jobs.map(job => (
                        <div key={job.id} className="job-card" onClick={() => onSelectJob(job.id)}>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '10px' }}>
                                <div style={{ flex: 1 }}>
                                    <h3 style={{ marginBottom: '10px', color: '#374151' }}>
                                        {job.project_description.substring(0, 100)}
                                        {job.project_description.length > 100 && '...'}
                                    </h3>
                                    <div style={{ color: '#6b7280', fontSize: '14px' }}>
                                        Created: {new Date(job.created_at).toLocaleString()}
                                    </div>
                                    {job.completed_at && (
                                        <div style={{ color: '#6b7280', fontSize: '14px' }}>
                                            Completed: {new Date(job.completed_at).toLocaleString()}
                                        </div>
                                    )}
                                </div>
                                <span className={`job-status ${job.status}`}>
                                    {job.status}
                                </span>
                            </div>
                            <div style={{ color: '#9ca3af', fontSize: '12px', marginTop: '10px' }}>
                                ID: {job.id}
                            </div>
                        </div>
                    ))}
                </div>
            );
        }
        
        function JobDetails({ job, showNotification }) {
            const [selectedExpertType, setSelectedExpertType] = useState('all');
            const experts = job.experts || [];
            
            // Get unique expert types
            const expertTypes = job.raw_outputs?.expert_types || [];
            
            // Filter experts based on selected type
            const filteredExperts = selectedExpertType === 'all' 
                ? experts 
                : experts.filter(expert => expert.expert_type === selectedExpertType);
            
            const sortedExperts = [...filteredExperts].sort((a, b) => b.relevance_score - a.relevance_score);
            
            // Calculate LLM health status
            const getLLMStatus = () => {
                if (!job.llm_metrics) return { status: 'healthy', label: 'No data' };
                
                const successRate = job.llm_metrics.successful_calls / job.llm_metrics.total_calls;
                if (successRate >= 0.9) return { status: 'healthy', label: 'Healthy' };
                if (successRate >= 0.7) return { status: 'warning', label: 'Warning' };
                return { status: 'error', label: 'Issues' };
            };
            
            const llmStatus = getLLMStatus();
            
            return (
                <div>
                    <h2 style={{ marginBottom: '20px' }}>Job Results</h2>
                    
                    <div className="job-description">
                        {job.request_id && <div style={{ marginBottom: '10px', fontSize: '12px', color: '#6b7280' }}>ID: {job.request_id}</div>}
                        <strong>Project Description:</strong> {job.project_description || 'Loading...'}
                    </div>
                    
                    {job.metadata && (
                        <div className="metadata">
                            <div>
                                <strong>Created:</strong> {new Date(job.metadata.created_at).toLocaleString()}
                            </div>
                            <div>
                                <strong>Processing Time:</strong> {Math.round(job.metadata.processing_time_seconds)}s
                            </div>
                            <div>
                                <strong>Experts Found:</strong> {experts.length}
                            </div>
                            {job.llm_metrics && (
                                <div style={{ marginTop: '5px', position: 'relative' }}>
                                    <div className="llm-status-indicator" style={{ position: 'relative', display: 'inline-block' }}>
                                        <div className={`llm-status-dot ${llmStatus.status}`}></div>
                                        <span>LLM Status: {llmStatus.label}</span>
                            
                            <div className="llm-metrics-popup">
                                <h3 style={{ marginBottom: '15px', fontSize: '16px' }}>LLM Call Metrics</h3>
                                <div className="metrics-grid">
                                    <div className="metric-card">
                                        <div className="metric-label">Total Calls</div>
                                        <div className="metric-value">{job.llm_metrics.total_calls}</div>
                                    </div>
                                    <div className="metric-card">
                                        <div className="metric-label">Success Rate</div>
                                        <div className="metric-value">
                                            {Math.round((job.llm_metrics.successful_calls / job.llm_metrics.total_calls) * 100)}%
                                        </div>
                                    </div>
                                    <div className="metric-card">
                                        <div className="metric-label">Avg Time</div>
                                        <div className="metric-value">
                                            {(job.llm_metrics.avg_duration_ms / 1000).toFixed(1)}s
                                        </div>
                                    </div>
                                    <div className="metric-card">
                                        <div className="metric-label">Retries</div>
                                        <div className="metric-value">{job.llm_metrics.total_retries}</div>
                                    </div>
                                </div>
                                
                                {job.llm_metrics.by_operation && (
                                    <div style={{ marginTop: '15px' }}>
                                        <h4 style={{ fontSize: '14px', marginBottom: '10px' }}>By Operation</h4>
                                        <table className="metrics-table">
                                            <thead>
                                                <tr>
                                                    <th>Operation</th>
                                                    <th>Calls</th>
                                                    <th>Success</th>
                                                    <th>Time</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {Object.entries(job.llm_metrics.by_operation).map(([op, stats]) => (
                                                    <tr key={op}>
                                                        <td>{op.replace(/_/g, ' ')}</td>
                                                        <td>{stats.calls}</td>
                                                        <td>{stats.success_rate}%</td>
                                                        <td>{(stats.avg_duration_ms / 1000).toFixed(1)}s</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                )}
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                    
                    {expertTypes.length > 0 && (
                        <div className="expert-filters">
                            <span className="filter-label">Filter by Expert Type:</span>
                            <button 
                                className={`filter-button ${selectedExpertType === 'all' ? 'active' : ''}`}
                                onClick={() => setSelectedExpertType('all')}
                            >
                                All ({experts.length})
                            </button>
                            {expertTypes.map((type, idx) => {
                                const count = experts.filter(e => e.expert_type === type.expert_title).length;
                                return (
                                    <button 
                                        key={idx}
                                        className={`filter-button ${selectedExpertType === type.expert_title ? 'active' : ''}`}
                                        onClick={() => setSelectedExpertType(type.expert_title)}
                                    >
                                        {type.expert_title} ({count})
                                    </button>
                                );
                            })}
                        </div>
                    )}
                    
                    <div className="expert-grid">
                        {sortedExperts.map((expert, index) => (
                            <div key={expert.id || index} className="expert-card">
                                <div className="expert-header">
                                    <div className="expert-info">
                                        <h3>
                                            {expert.linkedin_url ? (
                                                <a href={expert.linkedin_url} target="_blank" rel="noopener noreferrer">
                                                    {expert.name}
                                                </a>
                                            ) : (
                                                <span className="no-linkedin">{expert.name}</span>
                                            )}
                                        </h3>
                                        <div className="expert-title">{expert.title}</div>
                                        <div className="expert-company">{expert.company}</div>
                                        <div className="expert-email">
                                            {expert.email ? (
                                                <a href={`mailto:${expert.email}`}>{expert.email}</a>
                                            ) : (
                                                <span className="no-email">No email available</span>
                                            )}
                                        </div>
                                    </div>
                                    <div className="expert-score">
                                        {(expert.relevance_score * 100).toFixed(0)}%
                                        <div className="score-tooltip">
                                            <div>Total Score: {expert.relevance_score.toFixed(2)}</div>
                                            <div className="score-breakdown">
                                                <div className="score-item">
                                                    <span>Type Importance:</span>
                                                    <span>{expert.type_importance_score?.toFixed(2) || '0.00'}</span>
                                                </div>
                                                <div className="score-item">
                                                    <span>Expert Matching:</span>
                                                    <span>{expert.relevancy_to_type_score?.toFixed(2) || '0.00'}</span>
                                                </div>
                                                <div className="score-item">
                                                    <span>Responsiveness:</span>
                                                    <span>{expert.responsiveness_score?.toFixed(2) || '0.00'}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="expert-reasons">
                                    <h4>Why Relevant:</h4>
                                    <ul>
                                        {(Array.isArray(expert.matching_reasons) 
                                            ? expert.matching_reasons 
                                            : [expert.matching_reasons || 'Relevant expertise']
                                        ).map((reason, idx) => {
                                            // Parse citations - look for citeturn patterns
                                            const parts = [];
                                            const citationRegex = /citeturn(\d+)search(\d+)/g;
                                            let lastIndex = 0;
                                            let match;
                                            
                                            while ((match = citationRegex.exec(reason)) !== null) {
                                                // Add text before citation
                                                if (match.index > lastIndex) {
                                                    parts.push(reason.substring(lastIndex, match.index));
                                                }
                                                // Add citation as superscript link
                                                const citeNum = match[1];
                                                parts.push(
                                                    <sup key={match.index}>
                                                        <a 
                                                            href="#" 
                                                            onClick={(e) => {
                                                                e.preventDefault();
                                                                alert(`Source citation ${citeNum} - This would link to the original source`);
                                                            }}
                                                            style={{color: '#3b82f6', textDecoration: 'none'}} 
                                                            title={`View source ${citeNum}`}
                                                        >
                                                            [{citeNum}]
                                                        </a>
                                                    </sup>
                                                );
                                                lastIndex = match.index + match[0].length;
                                            }
                                            
                                            // Add remaining text
                                            if (lastIndex < reason.length) {
                                                parts.push(reason.substring(lastIndex));
                                            }
                                            
                                            return (
                                                <li key={idx}>
                                                    {parts.length > 0 ? parts : reason}
                                                </li>
                                            );
                                        })}
                                    </ul>
                                </div>
                                
                                {expert.areas_of_expertise && expert.areas_of_expertise.length > 0 && (
                                    <div className="expert-expertise">
                                        <h4>Areas of Expertise:</h4>
                                        <div className="expertise-tags">
                                            {expert.areas_of_expertise.map((area, idx) => (
                                                <span key={idx} className="expertise-tag">{area}</span>
                                            ))}
                                        </div>
                                    </div>
                                )}
                                
                                {expert.conversation_topics && expert.conversation_topics.length > 0 && (
                                    <div className="expert-topics">
                                        <h4>Discussion Topics:</h4>
                                        <ul>
                                            {expert.conversation_topics.map((topic, idx) => (
                                                <li key={idx}>{topic}</li>
                                            ))}
                                        </ul>
                                    </div>
                                )}
                                
                                {expert.personalised_message && (
                                    <div className="expert-actions">
                                        <div className="personalized-message-preview">
                                            <p style={{ fontSize: '14px', color: '#6b7280', marginBottom: '10px' }}>
                                                {expert.personalised_message.substring(0, 100)}...
                                            </p>
                                            <button 
                                                className="copy-button"
                                                onClick={() => {
                                                    navigator.clipboard.writeText(expert.personalised_message);
                                                    showNotification('Personalized message copied to clipboard!');
                                                }}
                                                style={{
                                                    padding: '6px 12px',
                                                    background: '#3b82f6',
                                                    color: 'white',
                                                    border: 'none',
                                                    borderRadius: '6px',
                                                    cursor: 'pointer',
                                                    fontSize: '14px',
                                                    transition: 'background 0.2s ease'
                                                }}
                                                onMouseOver={(e) => e.target.style.background = '#2563eb'}
                                                onMouseOut={(e) => e.target.style.background = '#3b82f6'}
                                            >
                                                Copy Full Message
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        }
        
        function CreateJobForm({ onSubmit }) {
            const [projectDescription, setProjectDescription] = useState('');
            const [effortLevel, setEffortLevel] = useState('low');
            const [isSubmitting, setIsSubmitting] = useState(false);
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!projectDescription.trim()) {
                    alert('Please enter a project description');
                    return;
                }
                
                setIsSubmitting(true);
                try {
                    // Set environment variables based on effort level
                    const envSettings = {
                        low: { reasoning: 'low', search: 'low', timeout: 300000 },
                        medium: { reasoning: 'medium', search: 'medium', timeout: 600000 },
                        high: { reasoning: 'high', search: 'high', timeout: 900000 }
                    };
                    
                    const settings = envSettings[effortLevel];
                    
                    // In production, these would be set as environment variables
                    // For now, we'll include them in the API call or use defaults
                    await onSubmit(projectDescription, effortLevel);
                    
                    // Reset form
                    setProjectDescription('');
                    setEffortLevel('low');
                } finally {
                    setIsSubmitting(false);
                }
            };
            
            return (
                <div className="create-job-form">
                    <h2 style={{ marginBottom: '30px' }}>Create New Expert Sourcing Job</h2>
                    
                    <form onSubmit={handleSubmit}>
                        <div className="form-group">
                            <label className="form-label" htmlFor="project-description">
                                Project Description
                            </label>
                            <textarea
                                id="project-description"
                                className="form-textarea"
                                value={projectDescription}
                                onChange={(e) => setProjectDescription(e.target.value)}
                                placeholder="Describe your project in detail. Include the technology stack, business goals, and specific expertise you're looking for..."
                                required
                            />
                        </div>
                        
                        <div className="form-group">
                            <label className="form-label">
                                Search Effort Level
                            </label>
                            <div className="effort-selector">
                                <div 
                                    className={`effort-option ${effortLevel === 'low' ? 'selected' : ''}`}
                                    onClick={() => setEffortLevel('low')}
                                >
                                    <h4>Low</h4>
                                    <p>Quick search (5 min)</p>
                                    <p style={{ fontSize: '12px' }}>Basic reasoning & search</p>
                                </div>
                                <div 
                                    className={`effort-option ${effortLevel === 'medium' ? 'selected' : ''}`}
                                    onClick={() => setEffortLevel('medium')}
                                >
                                    <h4>Medium</h4>
                                    <p>Standard search (10 min)</p>
                                    <p style={{ fontSize: '12px' }}>Enhanced analysis</p>
                                </div>
                                <div 
                                    className={`effort-option ${effortLevel === 'high' ? 'selected' : ''}`}
                                    onClick={() => setEffortLevel('high')}
                                >
                                    <h4>High</h4>
                                    <p>Deep search (15 min)</p>
                                    <p style={{ fontSize: '12px' }}>Comprehensive results</p>
                                </div>
                            </div>
                        </div>
                        
                        <button 
                            type="submit" 
                            className="form-submit"
                            disabled={isSubmitting}
                        >
                            {isSubmitting ? 'Creating Job...' : 'Create Expert Sourcing Job'}
                        </button>
                    </form>
                </div>
            );
        }
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>